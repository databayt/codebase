{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "faceted",
  "description": "Faceted filter component for data tables",
  "type": "registry:atom",
  "registryDependencies": [
    "button",
    "popover",
    "checkbox",
    "separator",
    "badge"
  ],
  "files": [
    {
      "path": "components/atom/faceted.tsx",
      "content": "\"use client\";\r\n\r\nimport { Check, ChevronsUpDown } from \"lucide-react\";\r\nimport * as React from \"react\";\r\n\r\nimport { Badge } from \"@/components/ui/badge\";\r\nimport {\r\n  Command,\r\n  CommandEmpty,\r\n  CommandGroup,\r\n  CommandInput,\r\n  CommandItem,\r\n  CommandList,\r\n  CommandSeparator,\r\n} from \"@/components/ui/command\";\r\nimport {\r\n  Popover,\r\n  PopoverContent,\r\n  PopoverTrigger,\r\n} from \"@/components/ui/popover\";\r\nimport { cn } from \"@/lib/utils\";\r\n\r\ntype FacetedValue<Multiple extends boolean> = Multiple extends true\r\n  ? string[]\r\n  : string;\r\n\r\ninterface FacetedContextValue<Multiple extends boolean = boolean> {\r\n  value?: FacetedValue<Multiple>;\r\n  onItemSelect?: (value: string) => void;\r\n  multiple?: Multiple;\r\n}\r\n\r\nconst FacetedContext = React.createContext<FacetedContextValue<boolean> | null>(\r\n  null,\r\n);\r\n\r\nfunction useFacetedContext(name: string) {\r\n  const context = React.useContext(FacetedContext);\r\n  if (!context) {\r\n    throw new Error(`\\`${name}\\` must be within Faceted`);\r\n  }\r\n  return context;\r\n}\r\n\r\ninterface FacetedProps<Multiple extends boolean = false>\r\n  extends React.ComponentProps<typeof Popover> {\r\n  value?: FacetedValue<Multiple>;\r\n  onValueChange?: (value: FacetedValue<Multiple> | undefined) => void;\r\n  children?: React.ReactNode;\r\n  multiple?: Multiple;\r\n}\r\n\r\nfunction Faceted<Multiple extends boolean = false>(\r\n  props: FacetedProps<Multiple>,\r\n) {\r\n  const {\r\n    open: openProp,\r\n    onOpenChange: onOpenChangeProp,\r\n    value,\r\n    onValueChange,\r\n    children,\r\n    multiple = false,\r\n    ...facetedProps\r\n  } = props;\r\n\r\n  const [uncontrolledOpen, setUncontrolledOpen] = React.useState(false);\r\n  const isControlled = openProp !== undefined;\r\n  const open = isControlled ? openProp : uncontrolledOpen;\r\n\r\n  const onOpenChange = React.useCallback(\r\n    (newOpen: boolean) => {\r\n      if (!isControlled) {\r\n        setUncontrolledOpen(newOpen);\r\n      }\r\n      onOpenChangeProp?.(newOpen);\r\n    },\r\n    [isControlled, onOpenChangeProp],\r\n  );\r\n\r\n  const onItemSelect = React.useCallback(\r\n    (selectedValue: string) => {\r\n      if (!onValueChange) return;\r\n\r\n      if (multiple) {\r\n        const currentValue = (Array.isArray(value) ? value : []) as string[];\r\n        const newValue = currentValue.includes(selectedValue)\r\n          ? currentValue.filter((v) => v !== selectedValue)\r\n          : [...currentValue, selectedValue];\r\n        onValueChange(newValue as FacetedValue<Multiple>);\r\n      } else {\r\n        if (value === selectedValue) {\r\n          onValueChange(undefined);\r\n        } else {\r\n          onValueChange(selectedValue as FacetedValue<Multiple>);\r\n        }\r\n\r\n        requestAnimationFrame(() => onOpenChange(false));\r\n      }\r\n    },\r\n    [multiple, value, onValueChange, onOpenChange],\r\n  );\r\n\r\n  const contextValue = React.useMemo<FacetedContextValue<typeof multiple>>(\r\n    () => ({ value, onItemSelect, multiple }),\r\n    [value, onItemSelect, multiple],\r\n  );\r\n\r\n  return (\r\n    <FacetedContext.Provider value={contextValue}>\r\n      <Popover open={open} onOpenChange={onOpenChange} {...facetedProps}>\r\n        {children}\r\n      </Popover>\r\n    </FacetedContext.Provider>\r\n  );\r\n}\r\n\r\nfunction FacetedTrigger(props: React.ComponentProps<typeof PopoverTrigger>) {\r\n  const { className, children, ...triggerProps } = props;\r\n\r\n  return (\r\n    <PopoverTrigger\r\n      {...triggerProps}\r\n      className={cn(\"justify-between text-left\", className)}\r\n    >\r\n      {children}\r\n    </PopoverTrigger>\r\n  );\r\n}\r\n\r\ninterface FacetedBadgeListProps extends React.ComponentProps<\"div\"> {\r\n  options?: { label: string; value: string }[];\r\n  max?: number;\r\n  badgeClassName?: string;\r\n  placeholder?: string;\r\n}\r\n\r\nfunction FacetedBadgeList(props: FacetedBadgeListProps) {\r\n  const {\r\n    options = [],\r\n    max = 2,\r\n    placeholder = \"Select options...\",\r\n    className,\r\n    badgeClassName,\r\n    ...badgeListProps\r\n  } = props;\r\n\r\n  const context = useFacetedContext(\"FacetedBadgeList\");\r\n  const values = Array.isArray(context.value)\r\n    ? context.value\r\n    : ([context.value].filter(Boolean) as string[]);\r\n\r\n  const getLabel = React.useCallback(\r\n    (value: string) => {\r\n      const option = options.find((opt) => opt.value === value);\r\n      return option?.label ?? value;\r\n    },\r\n    [options],\r\n  );\r\n\r\n  if (!values || values.length === 0) {\r\n    return (\r\n      <div\r\n        {...badgeListProps}\r\n        className=\"flex w-full items-center gap-1 text-muted-foreground\"\r\n      >\r\n        {placeholder}\r\n        <ChevronsUpDown className=\"ml-auto size-4 shrink-0 opacity-50\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div\r\n      {...badgeListProps}\r\n      className={cn(\"flex flex-wrap items-center gap-1\", className)}\r\n    >\r\n      {values.length > max ? (\r\n        <Badge\r\n          variant=\"secondary\"\r\n          className={cn(\"rounded-sm px-1 font-normal\", badgeClassName)}\r\n        >\r\n          {values.length} selected\r\n        </Badge>\r\n      ) : (\r\n        values.map((value) => (\r\n          <Badge\r\n            key={value}\r\n            variant=\"secondary\"\r\n            className={cn(\"rounded-sm px-1 font-normal\", badgeClassName)}\r\n          >\r\n            <span className=\"truncate\">{getLabel(value)}</span>\r\n          </Badge>\r\n        ))\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction FacetedContent(props: React.ComponentProps<typeof PopoverContent>) {\r\n  const { className, children, ...contentProps } = props;\r\n\r\n  return (\r\n    <PopoverContent\r\n      {...contentProps}\r\n      align=\"start\"\r\n      className={cn(\r\n        \"w-[200px] origin-(--radix-popover-content.tsx-transform-origin) p-0\",\r\n        className,\r\n      )}\r\n    >\r\n      <Command>{children}</Command>\r\n    </PopoverContent>\r\n  );\r\n}\r\n\r\nconst FacetedInput = CommandInput;\r\n\r\nconst FacetedList = CommandList;\r\n\r\nconst FacetedEmpty = CommandEmpty;\r\n\r\nconst FacetedGroup = CommandGroup;\r\n\r\ninterface FacetedItemProps extends React.ComponentProps<typeof CommandItem> {\r\n  value: string;\r\n}\r\n\r\nfunction FacetedItem(props: FacetedItemProps) {\r\n  const { value, onSelect, className, children, ...itemProps } = props;\r\n  const context = useFacetedContext(\"FacetedItem\");\r\n\r\n  const isSelected = context.multiple\r\n    ? Array.isArray(context.value) && context.value.includes(value)\r\n    : context.value === value;\r\n\r\n  const onItemSelect = React.useCallback(\r\n    (currentValue: string) => {\r\n      if (onSelect) {\r\n        onSelect(currentValue);\r\n      } else if (context.onItemSelect) {\r\n        context.onItemSelect(currentValue);\r\n      }\r\n    },\r\n    [onSelect, context.onItemSelect],\r\n  );\r\n\r\n  return (\r\n    <CommandItem\r\n      aria-selected={isSelected}\r\n      data-selected={isSelected}\r\n      className={cn(\"gap-2\", className)}\r\n      onSelect={() => onItemSelect(value)}\r\n      {...itemProps}\r\n    >\r\n      <span\r\n        className={cn(\r\n          \"flex size-4 items-center justify-center rounded-sm border border-primary\",\r\n          isSelected\r\n            ? \"bg-primary text-primary-foreground\"\r\n            : \"opacity-50 [&_svg]:invisible\",\r\n        )}\r\n      >\r\n        <Check className=\"size-4\" />\r\n      </span>\r\n      {children}\r\n    </CommandItem>\r\n  );\r\n}\r\n\r\nconst FacetedSeparator = CommandSeparator;\r\n\r\nexport {\r\n  Faceted,\r\n  FacetedBadgeList,\r\n  FacetedContent,\r\n  FacetedEmpty,\r\n  FacetedGroup,\r\n  FacetedInput,\r\n  FacetedItem,\r\n  FacetedList,\r\n  FacetedSeparator,\r\n  FacetedTrigger,\r\n};\r\n",
      "type": "registry:component",
      "target": "components/faceted.tsx"
    }
  ],
  "categories": [
    "form",
    "interactive"
  ]
}