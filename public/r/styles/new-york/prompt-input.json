{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "prompt-input",
  "description": "Advanced prompt input with keyboard shortcuts and suggestions",
  "type": "registry:atom",
  "registryDependencies": [
    "button",
    "textarea"
  ],
  "files": [
    {
      "path": "components/atom/prompt-input.tsx",
      "content": "'use client';\n\nimport { Button } from '@/components/ui/button';\nimport {\n    DropdownMenu,\n    DropdownMenuContent,\n    DropdownMenuItem,\n    DropdownMenuTrigger,\n} from '@/components/ui/dropdown-menu';\nimport {\n    Select,\n    SelectContent,\n    SelectItem,\n    SelectTrigger,\n    SelectValue,\n} from '@/components/ui/select';\nimport { Textarea } from '@/components/ui/textarea';\nimport { cn } from '@/lib/utils';\nimport type { ChatStatus, FileUIPart } from 'ai';\nimport {\n    ImageIcon,\n    Loader2Icon,\n    PaperclipIcon,\n    PlusIcon,\n    SendIcon,\n    SquareIcon,\n    XIcon,\n} from 'lucide-react';\nimport { nanoid } from 'nanoid';\nimport {\n    type ChangeEventHandler,\n    Children,\n    type ComponentProps,\n    createContext,\n    type FormEvent,\n    type FormEventHandler,\n    Fragment,\n    type HTMLAttributes,\n    type KeyboardEventHandler,\n    type RefObject,\n    useCallback,\n    useContext,\n    useEffect,\n    useLayoutEffect,\n    useMemo,\n    useRef,\n    useState,\n} from 'react';\n\ntype AttachmentsContext = {\n    files: (FileUIPart & { id: string })[];\n    add: (files: File[] | FileList) => void;\n    remove: (id: string) => void;\n    clear: () => void;\n    openFileDialog: () => void;\n    fileInputRef: RefObject<HTMLInputElement | null>;\n};\n\nconst AttachmentsContext = createContext<AttachmentsContext | null>(null);\n\nexport const usePromptInputAttachments = () => {\n    const context = useContext(AttachmentsContext);\n\n    if (!context) {\n        throw new Error(\n            'usePromptInputAttachments must be used within a PromptInput',\n        );\n    }\n\n    return context;\n};\n\nexport type PromptInputAttachmentProps = HTMLAttributes<HTMLDivElement> & {\n    data: FileUIPart & { id: string };\n    className?: string;\n};\n\nexport function PromptInputAttachment({\n                                          data,\n                                          className,\n                                          ...props\n                                      }: PromptInputAttachmentProps) {\n    const attachments = usePromptInputAttachments();\n\n    return (\n        <div\n            className={cn('group relative h-14 w-14 rounded-md border', className)}\n            key={data.id}\n            {...props}\n        >\n            {data.mediaType?.startsWith('image/') && data.url ? (\n                <img\n                    alt={data.filename || 'attachment'}\n                    className=\"size-full rounded-md object-cover\"\n                    height={56}\n                    src={data.url}\n                    width={56}\n                />\n            ) : (\n                <div className=\"flex size-full items-center justify-center text-muted-foreground\">\n                    <PaperclipIcon className=\"size-4\" />\n                </div>\n            )}\n            <Button\n                aria-label=\"Remove attachment\"\n                className=\"-right-1.5 -top-1.5 absolute h-6 w-6 rounded-full opacity-0 group-hover:opacity-100\"\n                onClick={() => attachments.remove(data.id)}\n                size=\"icon\"\n                type=\"button\"\n                variant=\"outline\"\n            >\n                <XIcon className=\"h-3 w-3\" />\n            </Button>\n        </div>\n    );\n}\n\nexport type PromptInputAttachmentsProps = Omit<\n    HTMLAttributes<HTMLDivElement>,\n    'children'\n> & {\n    children: (attachment: FileUIPart & { id: string }) => React.ReactNode;\n};\n\nexport function PromptInputAttachments({\n                                           className,\n                                           children,\n                                           ...props\n                                       }: PromptInputAttachmentsProps) {\n    const attachments = usePromptInputAttachments();\n    const [height, setHeight] = useState(0);\n    const contentRef = useRef<HTMLDivElement>(null);\n\n    useLayoutEffect(() => {\n        const el = contentRef.current;\n        if (!el) {\n            return;\n        }\n        const ro = new ResizeObserver(() => {\n            setHeight(el.getBoundingClientRect().height);\n        });\n        ro.observe(el);\n        setHeight(el.getBoundingClientRect().height);\n        return () => ro.disconnect();\n    }, []);\n\n    return (\n        <div\n            aria-live=\"polite\"\n            className={cn(\n                'overflow-hidden transition-[height] duration-200 ease-out',\n                className,\n            )}\n            style={{ height: attachments.files.length ? height : 0 }}\n            {...props}\n        >\n            <div className=\"flex flex-wrap gap-2 p-3 pt-3\" ref={contentRef}>\n                {attachments.files.map((file) => (\n                    <Fragment key={file.id}>{children(file)}</Fragment>\n                ))}\n            </div>\n        </div>\n    );\n}\n\nexport type PromptInputActionAddAttachmentsProps = ComponentProps<\n    typeof DropdownMenuItem\n> & {\n    label?: string;\n};\n\nexport const PromptInputActionAddAttachments = ({\n                                                    label = 'Add photos or files',\n                                                    ...props\n                                                }: PromptInputActionAddAttachmentsProps) => {\n    const attachments = usePromptInputAttachments();\n\n    return (\n        <DropdownMenuItem\n            {...props}\n            onSelect={(e) => {\n                e.preventDefault();\n                attachments.openFileDialog();\n            }}\n        >\n            <ImageIcon className=\"mr-2 size-4\" /> {label}\n        </DropdownMenuItem>\n    );\n};\n\nexport type PromptInputMessage = {\n    text?: string;\n    files?: FileUIPart[];\n};\n\nexport type PromptInputProps = Omit<\n    HTMLAttributes<HTMLFormElement>,\n    'onSubmit'\n> & {\n    accept?: string; // e.g., \"image/*\" or leave undefined for any\n    multiple?: boolean;\n    // When true, accepts drops anywhere on document. Default false (opt-in).\n    globalDrop?: boolean;\n    // Render a hidden input with given name and keep it in sync for native form posts. Default false.\n    syncHiddenInput?: boolean;\n    // Minimal constraints\n    maxFiles?: number;\n    maxFileSize?: number; // bytes\n    onError?: (err: {\n        code: 'max_files' | 'max_file_size' | 'accept';\n        message: string;\n    }) => void;\n    onSubmit: (\n        message: PromptInputMessage,\n        event: FormEvent<HTMLFormElement>,\n    ) => void;\n};\n\nexport const PromptInput = ({\n                                className,\n                                accept,\n                                multiple,\n                                globalDrop,\n                                syncHiddenInput,\n                                maxFiles,\n                                maxFileSize,\n                                onError,\n                                onSubmit,\n                                ...props\n                            }: PromptInputProps) => {\n    const [items, setItems] = useState<(FileUIPart & { id: string })[]>([]);\n    const inputRef = useRef<HTMLInputElement | null>(null);\n    const anchorRef = useRef<HTMLSpanElement>(null);\n    const formRef = useRef<HTMLFormElement | null>(null);\n\n    // Find nearest form to scope drag & drop\n    useEffect(() => {\n        const root = anchorRef.current?.closest('form');\n        if (root instanceof HTMLFormElement) {\n            formRef.current = root;\n        }\n    }, []);\n\n    const openFileDialog = useCallback(() => {\n        inputRef.current?.click();\n    }, []);\n\n    const matchesAccept = useCallback(\n        (f: File) => {\n            if (!accept || accept.trim() === '') {\n                return true;\n            }\n            // Simple check: if accept includes \"image/*\", filter to images; otherwise allow.\n            if (accept.includes('image/*')) {\n                return f.type.startsWith('image/');\n            }\n            return true;\n        },\n        [accept],\n    );\n\n    const add = useCallback(\n        (files: File[] | FileList) => {\n            const incoming = Array.from(files);\n            const accepted = incoming.filter((f) => matchesAccept(f));\n            if (accepted.length === 0) {\n                onError?.({\n                    code: 'accept',\n                    message: 'No files match the accepted types.',\n                });\n                return;\n            }\n            const withinSize = (f: File) =>\n                maxFileSize ? f.size <= maxFileSize : true;\n            const sized = accepted.filter(withinSize);\n            if (sized.length === 0 && accepted.length > 0) {\n                onError?.({\n                    code: 'max_file_size',\n                    message: 'All files exceed the maximum size.',\n                });\n                return;\n            }\n            setItems((prev) => {\n                const capacity =\n                    typeof maxFiles === 'number'\n                        ? Math.max(0, maxFiles - prev.length)\n                        : undefined;\n                const capped =\n                    typeof capacity === 'number' ? sized.slice(0, capacity) : sized;\n                if (typeof capacity === 'number' && sized.length > capacity) {\n                    onError?.({\n                        code: 'max_files',\n                        message: 'Too many files. Some were not added.',\n                    });\n                }\n                const next: (FileUIPart & { id: string })[] = [];\n                for (const file of capped) {\n                    next.push({\n                        id: nanoid(),\n                        type: 'file',\n                        url: URL.createObjectURL(file),\n                        mediaType: file.type,\n                        filename: file.name,\n                    });\n                }\n                return prev.concat(next);\n            });\n        },\n        [matchesAccept, maxFiles, maxFileSize, onError],\n    );\n\n    const remove = useCallback((id: string) => {\n        setItems((prev) => {\n            const found = prev.find((file) => file.id === id);\n            if (found?.url) {\n                URL.revokeObjectURL(found.url);\n            }\n            return prev.filter((file) => file.id !== id);\n        });\n    }, []);\n\n    const clear = useCallback(() => {\n        setItems((prev) => {\n            for (const file of prev) {\n                if (file.url) {\n                    URL.revokeObjectURL(file.url);\n                }\n            }\n            return [];\n        });\n    }, []);\n\n    // Note: File input cannot be programmatically set for security reasons\n    // The syncHiddenInput prop is no longer functional\n    useEffect(() => {\n        if (syncHiddenInput && inputRef.current) {\n            // Clear the input when items are cleared\n            if (items.length === 0) {\n                inputRef.current.value = '';\n            }\n        }\n    }, [items, syncHiddenInput]);\n\n    // Attach drop handlers on nearest form and document (opt-in)\n    useEffect(() => {\n        const form = formRef.current;\n        if (!form) {\n            return;\n        }\n        const onDragOver = (e: DragEvent) => {\n            if (e.dataTransfer?.types?.includes('Files')) {\n                e.preventDefault();\n            }\n        };\n        const onDrop = (e: DragEvent) => {\n            if (e.dataTransfer?.types?.includes('Files')) {\n                e.preventDefault();\n            }\n            if (e.dataTransfer?.files && e.dataTransfer.files.length > 0) {\n                add(e.dataTransfer.files);\n            }\n        };\n        form.addEventListener('dragover', onDragOver);\n        form.addEventListener('drop', onDrop);\n        return () => {\n            form.removeEventListener('dragover', onDragOver);\n            form.removeEventListener('drop', onDrop);\n        };\n    }, [add]);\n\n    useEffect(() => {\n        if (!globalDrop) {\n            return;\n        }\n        const onDragOver = (e: DragEvent) => {\n            if (e.dataTransfer?.types?.includes('Files')) {\n                e.preventDefault();\n            }\n        };\n        const onDrop = (e: DragEvent) => {\n            if (e.dataTransfer?.types?.includes('Files')) {\n                e.preventDefault();\n            }\n            if (e.dataTransfer?.files && e.dataTransfer.files.length > 0) {\n                add(e.dataTransfer.files);\n            }\n        };\n        document.addEventListener('dragover', onDragOver);\n        document.addEventListener('drop', onDrop);\n        return () => {\n            document.removeEventListener('dragover', onDragOver);\n            document.removeEventListener('drop', onDrop);\n        };\n    }, [add, globalDrop]);\n\n    const handleChange: ChangeEventHandler<HTMLInputElement> = (event) => {\n        if (event.currentTarget.files) {\n            add(event.currentTarget.files);\n        }\n    };\n\n    const handleSubmit: FormEventHandler<HTMLFormElement> = (event) => {\n        event.preventDefault();\n\n        const files: FileUIPart[] = items.map(({ ...item }) => ({\n            ...item,\n        }));\n\n        onSubmit({ text: event.currentTarget.message.value, files }, event);\n    };\n\n    const ctx = useMemo<AttachmentsContext>(\n        () => ({\n            files: items.map((item) => ({ ...item, id: item.id })),\n            add,\n            remove,\n            clear,\n            openFileDialog,\n            fileInputRef: inputRef,\n        }),\n        [items, add, remove, clear, openFileDialog],\n    );\n\n    return (\n        <AttachmentsContext.Provider value={ctx}>\n            <span aria-hidden=\"true\" className=\"hidden\" ref={anchorRef} />\n            <input\n                accept={accept}\n                className=\"hidden\"\n                multiple={multiple}\n                onChange={handleChange}\n                ref={inputRef}\n                type=\"file\"\n            />\n            <form\n                className={cn(\n                    'w-full overflow-hidden rounded-xl border bg-background shadow-sm',\n                    className,\n                )}\n                onSubmit={handleSubmit}\n                {...props}\n            />\n        </AttachmentsContext.Provider>\n    );\n};\n\nexport type PromptInputBodyProps = HTMLAttributes<HTMLDivElement>;\n\nexport const PromptInputBody = ({\n                                    className,\n                                    ...props\n                                }: PromptInputBodyProps) => (\n    <div className={cn(className, 'flex flex-col')} {...props} />\n);\n\nexport type PromptInputTextareaProps = ComponentProps<typeof Textarea>;\n\nexport const PromptInputTextarea = ({\n                                        onChange,\n                                        className,\n                                        placeholder = 'What would you like to know?',\n                                        ...props\n                                    }: PromptInputTextareaProps) => {\n    const handleKeyDown: KeyboardEventHandler<HTMLTextAreaElement> = (e) => {\n        if (e.key === 'Enter') {\n            // Don't submit if IME composition is in progress\n            if (e.nativeEvent.isComposing) {\n                return;\n            }\n\n            if (e.shiftKey) {\n                // Allow newline\n                return;\n            }\n\n            // Submit on Enter (without Shift)\n            e.preventDefault();\n            const form = e.currentTarget.form;\n            if (form) {\n                form.requestSubmit();\n            }\n        }\n    };\n\n    return (\n        <Textarea\n            className={cn(\n                'w-full resize-none rounded-none border-none shadow-none outline-none ring-0',\n                'field-sizing-content bg-transparent dark:bg-transparent',\n                'max-h-48 min-h-16',\n                'focus-visible:ring-0',\n                className,\n            )}\n            name=\"message\"\n            onChange={(e) => {\n                onChange?.(e);\n            }}\n            onKeyDown={handleKeyDown}\n            placeholder={placeholder}\n            {...props}\n        />\n    );\n};\n\nexport type PromptInputToolbarProps = HTMLAttributes<HTMLDivElement>;\n\nexport const PromptInputToolbar = ({\n                                       className,\n                                       ...props\n                                   }: PromptInputToolbarProps) => (\n    <div\n        className={cn('flex items-center justify-between p-1', className)}\n        {...props}\n    />\n);\n\nexport type PromptInputToolsProps = HTMLAttributes<HTMLDivElement>;\n\nexport const PromptInputTools = ({\n                                     className,\n                                     ...props\n                                 }: PromptInputToolsProps) => (\n    <div\n        className={cn(\n            'flex items-center gap-1',\n            '[&_button:first-child]:rounded-bl-xl',\n            className,\n        )}\n        {...props}\n    />\n);\n\nexport type PromptInputButtonProps = ComponentProps<typeof Button>;\n\nexport const PromptInputButton = ({\n                                      variant = 'ghost',\n                                      className,\n                                      size,\n                                      ...props\n                                  }: PromptInputButtonProps) => {\n    const newSize =\n        (size ?? Children.count(props.children) > 1) ? 'default' : 'icon';\n\n    return (\n        <Button\n            className={cn(\n                'shrink-0 gap-1.5 rounded-lg',\n                variant === 'ghost' && 'text-muted-foreground',\n                newSize === 'default' && 'px-3',\n                className,\n            )}\n            size={newSize}\n            type=\"button\"\n            variant={variant}\n            {...props}\n        />\n    );\n};\n\nexport type PromptInputActionMenuProps = ComponentProps<typeof DropdownMenu>;\nexport const PromptInputActionMenu = (props: PromptInputActionMenuProps) => (\n    <DropdownMenu {...props} />\n);\n\nexport type PromptInputActionMenuTriggerProps = ComponentProps<\n    typeof Button\n> & {};\nexport const PromptInputActionMenuTrigger = ({\n                                                 className,\n                                                 children,\n                                                 ...props\n                                             }: PromptInputActionMenuTriggerProps) => (\n    <DropdownMenuTrigger asChild>\n        <PromptInputButton className={className} {...props}>\n            {children ?? <PlusIcon className=\"size-4\" />}\n        </PromptInputButton>\n    </DropdownMenuTrigger>\n);\n\nexport type PromptInputActionMenuContentProps = ComponentProps<\n    typeof DropdownMenuContent\n>;\nexport const PromptInputActionMenuContent = ({\n                                                 className,\n                                                 ...props\n                                             }: PromptInputActionMenuContentProps) => (\n    <DropdownMenuContent align=\"start\" className={cn(className)} {...props} />\n);\n\nexport type PromptInputActionMenuItemProps = ComponentProps<\n    typeof DropdownMenuItem\n>;\nexport const PromptInputActionMenuItem = ({\n                                              className,\n                                              ...props\n                                          }: PromptInputActionMenuItemProps) => (\n    <DropdownMenuItem className={cn(className)} {...props} />\n);\n\n// Note: Actions that perform side-effects (like opening a file dialog)\n// are provided in opt-in modules (e.g., prompt-input-attachments).\n\nexport type PromptInputSubmitProps = ComponentProps<typeof Button> & {\n    status?: ChatStatus;\n};\n\nexport const PromptInputSubmit = ({\n                                      className,\n                                      variant = 'default',\n                                      size = 'icon',\n                                      status,\n                                      children,\n                                      ...props\n                                  }: PromptInputSubmitProps) => {\n    let Icon = <SendIcon className=\"size-4\" />;\n\n    if (status === 'submitted') {\n        Icon = <Loader2Icon className=\"size-4 animate-spin\" />;\n    } else if (status === 'streaming') {\n        Icon = <SquareIcon className=\"size-4\" />;\n    } else if (status === 'error') {\n        Icon = <XIcon className=\"size-4\" />;\n    }\n\n    return (\n        <Button\n            className={cn('gap-1.5 rounded-lg', className)}\n            size={size}\n            type=\"submit\"\n            variant={variant}\n            {...props}\n        >\n            {children ?? Icon}\n        </Button>\n    );\n};\n\nexport type PromptInputModelSelectProps = ComponentProps<typeof Select>;\n\nexport const PromptInputModelSelect = (props: PromptInputModelSelectProps) => (\n    <Select {...props} />\n);\n\nexport type PromptInputModelSelectTriggerProps = ComponentProps<\n    typeof SelectTrigger\n>;\n\nexport const PromptInputModelSelectTrigger = ({\n                                                  className,\n                                                  ...props\n                                              }: PromptInputModelSelectTriggerProps) => (\n    <SelectTrigger\n        className={cn(\n            'border-none bg-transparent font-medium text-muted-foreground shadow-none transition-colors',\n            'hover:bg-accent hover:text-foreground [&[aria-expanded=\"true\"]]:bg-accent [&[aria-expanded=\"true\"]]:text-foreground',\n            className,\n        )}\n        {...props}\n    />\n);\n\nexport type PromptInputModelSelectContentProps = ComponentProps<\n    typeof SelectContent\n>;\n\nexport const PromptInputModelSelectContent = ({\n                                                  className,\n                                                  ...props\n                                              }: PromptInputModelSelectContentProps) => (\n    <SelectContent className={cn(className)} {...props} />\n);\n\nexport type PromptInputModelSelectItemProps = ComponentProps<typeof SelectItem>;\n\nexport const PromptInputModelSelectItem = ({\n                                               className,\n                                               ...props\n                                           }: PromptInputModelSelectItemProps) => (\n    <SelectItem className={cn(className)} {...props} />\n);\n\nexport type PromptInputModelSelectValueProps = ComponentProps<\n    typeof SelectValue\n>;\n\nexport const PromptInputModelSelectValue = ({\n                                                className,\n                                                ...props\n                                            }: PromptInputModelSelectValueProps) => (\n    <SelectValue className={cn(className)} {...props} />\n);\n",
      "type": "registry:component",
      "target": "components/prompt-input.tsx"
    }
  ],
  "categories": [
    "ai",
    "form"
  ]
}